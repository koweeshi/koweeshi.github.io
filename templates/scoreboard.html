<!DOCTYPE html>
<html>
<head>
    <title>CWL NOV 2023</title>
    <style>
        @font-face {
            font-family: 'SupercellMagic';
            src: url('static/fonts/supercell-magic-webfont.ttf');
        }

        .body {
            font-family: 'SupercellMagic', Arial, sans-serif;
            background-color: #000000;
            background-image: url('static/images/back.jpg');
            background-size: cover;
            background-repeat:repeat-y;
            opacity: 1;
            margin: 0;
            padding: 20px;
        }

        /* .body::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            z-index: -1;
        } */

        .header {
            background-image: url('static/images/cover.jpg');
            background-size: cover;
            border: thick double #3D2D26;
            border-radius: 10px;
            background-repeat: no-repeat;
            background-clip: border-box;
            background-position: center;
            margin: 0 auto;
            padding: 40px 20px;
            text-align: center;
            width: 90%;
            height: max-content;
            position: relative;

        }

        .header::before{
            content: ''; /* Required content property for pseudo-elements */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.3); /* Background color with transparency */
            background-image: url('static/images/bg.gif');
            background-size: cover;
            opacity: 0.5;
            z-index: 1; /* Place the pseudo-element behind the header content */
        }

        /* Style the h1 header text within the bounding box */
        .header h1 {
            color: #FFD007; /* Text color */
            text-shadow: 4px 4px 8px rgba(0, 0, 0, 1);
            font-size: xx-large;
            text-align: center;
            vertical-align: top;
            padding: 0px;
            position: relative;
            z-index: 1;
        }
        
        .header h2 {
            color: #FFD007; /* Text color */
            text-shadow: 4px 4px 8px rgba(0, 0, 0, 1);
            font-size: x-large;
            text-align: center;
            vertical-align: top;
            padding: 0px 0px 10px 0px;
            position: relative;
            z-index: 1;
        }
        .line {
            display: flex;
            justify-content: space-between; /* Space evenly between the two sets of text */
        }

        .text-set {
            width: 100%; /* Occupy the entire width of the line */
            display: flex; /* Create a flex container for the two text sets */
            justify-content: space-between; /* Space evenly between text sets horizontally */
            align-items: center; /* Align text sets vertically */
        }

        .text-left,
        .text-right {
            width: 48%; /* Adjust the width as needed to fit both sets within the line */
        }

        /* Style the <p> elements as needed */
        .text-set p {
            margin: 0; /* Remove default margins for <p> elements */
        }

        .text-left {
            color: #ffffff; /* Text color */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 1);
            font-size: large;
            text-align: left;
            vertical-align: text-bottom;
            position: relative;
            z-index: 1;
        }

        .text-right {
            color: #ffffff; /* Text color */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 1);
            font-size: x-small;
            text-align: right;
            vertical-align: bottom;
            position: relative;
            z-index: 1;
        }
        /* .header h3 {
            color: #ffffff; 
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 1);
            font-size: large;
            text-align: left;
            vertical-align: text-bottom;
            position: relative;
            z-index: 1;
        } */

        /* .header h4 {
            color: #ffffff; 
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 1);
            font-size: x-small;
            text-align: right;
            vertical-align: bottom;
            position: relative;
            z-index: 1;
        } */

        .logo {
            display: flex;
            align-items: center;
            justify-content: center; /* Center the content horizontally within .logo */
            position: relative;
            z-index: 1;
        }

        .logo img {
            max-width: 50px; /* Adjust the width as needed */
            margin-right: 10px;
        }

        .logo p {
            color: #ffffff; /* Text color */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 1);
            font-size: large;
            text-align: center; /* Center align the text within .logo */
        }

        /* Add rounded borders and gradient background to table rows */
        table {
            width: 90%;
            margin: 0 auto;
            border-collapse: separate;
            border-spacing: 0 5px;
        }
        th, tr {
            overflow: hidden;
        }

        th {
            padding: 10px;
            text-align: center;
            background-color: #9B3518;
            font-size: x-small;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 1);
            color: #DB8A4C;
            /* border-top: 2px solid #5f200e;
            border-bottom: 2px solid #5f200e; */
            box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.5);
            min-height: 100px;
        }
        th:first-child, td:first-child {
            border-top-left-radius: 10px;
            border-bottom-left-radius: 10px;
        }

        th:last-child, td:last-child {
            border-top-right-radius: 10px;
            border-bottom-right-radius: 10px;
        }

        /* th:first-child {
            border-left: 2px solid #3D2D26;
        }

        th:last-child {
            border-right: 2px solid #3D2D26;
        } */

        td {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 1);
            padding: 10px;
            text-align: center;
            color: #fff;
            max-width: 150px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: auto;
        }


        tr {
            background-color: #8C6662;
            border-radius: 10px;
            box-shadow: 2px 2px 2px 2px rgba(0, 0, 0, 0.5);
        }

        tr:first-of-type {
            background-color: #c5a800;
            border: 4px solid #c5a800
        }

        tr:nth-of-type(2) {
            background-color: #8d8d8d;
        }

        tr:nth-of-type(3) {
            background-color: #995f25;
        }

        /* Add hover effect to table rows */
        tr:hover {
            border-radius: 10px;
            background-color: #657998;
            box-shadow: 4px 4px 4px 4px rgba(0, 0, 0, 0.5);
        }

        .center-container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: auto /* Adjust as needed for vertical centering */
        }

        .my-button {
            background-color: #9B3518;
            color: #DB8A4C;
            padding: 10px 20px;
            border:rgb(255, 255, 255);
            border-width: 2px;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'SupercellMagic', Arial, sans-serif;
            font-size: xx-small;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 1);
        }

        /* Center the button horizontally */
        #buttonRow {
            align-items: center;
        }

    </style>
</head>
    <body class = 'body'>
        <div class = 'gif'>

        </div>
        <div class = 'header'>
            <div class = 'logo'>
                <img src="static/images/clanbadge.png", alt="Badge">
                <p>GianMarco Army</p>
            </div>
            <h1>Clan War League</h1>
            <h2>November 2023 Season</h2>
            <div class="line">
                <div class="text-set">
                    <div class="text-left">
                        <p>Round {{ limited_data[0]['Round'] }}/7</p>
                    </div>
                    <div class="text-right">
                        <p>Last Updated: {{ limited_data[0]['Update']}}</p>
                    </div>
                </div>
            </div>
            
            
        </div>

        <table id="scoreboard">
            <tr>
                <th>Position</th>
                <th>Player</th>
                <th>Total Stars</th>
                <th>Destruction %</th>
                <th>Bonuses</th>
                <th>Demerit</th>
                <th>Attacks</th>
                <th>Details</th> <!-- New column for the toggle button -->
            </tr>
            {% for record in data %}
            <tr class="expandable-row">
                <td>{{ record['Position'] }}</td>
                <td>{{ record['Name'] }}</td>
                <td>{{ record['Total Stars'] }}</td>
                <td>{{ record['Total Percentage'] }}</td>
                <td>{{ record['Bonus Awarded'] }}</td>
                <td>{{ record['Demerit'] }}</td>
                <td>{{ record['Attacks'] }}/{{ limited_data[0]['Round'] }}</td>
                <td><button class="toggle-button">Details</button></td> <!-- Toggle button -->
            </tr>
            {% endfor %}
        </table>

        <div class="center-container">
            <button id="showMoreBtn" class="my-button">Show More</button>
        </div>

        <script>
            var limitedData = JSON.parse('{{ limited_data | tojson | safe }}');
            var fullData = JSON.parse('{{ full_data | tojson | safe }}');
            var attackData = JSON.parse('{{ attack_data | tojson | safe }}')
        </script>

        <script>
            // JavaScript to handle "Show More" button click
            const table = document.getElementById('scoreboard');
            const showMoreBtn = document.getElementById('showMoreBtn');
            let allRowsVisible = false;

            // Function to add rows to the table
            function addRows(data, startIndex, endIndex) {
                for (let i = startIndex; i < endIndex; i++) {
                    const record = data[i];
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td>${record['Position']}</td>
                        <td>${record['Name']}</td>
                        <td>${record['Total Stars']}</td>
                        <td>${record['Total Percentage']}</td>
                        <td>${record['Bonus Awarded']}</td>
                        <td>${record['Demerit']}</td>
                        <td>${record['Attacks']}/${record['Round']}
                        <td><button class="toggle-button">Details</button></td>
                    `;
                    table.appendChild(newRow);
                }
            }

            // Show the first 15 rows initially
            addRows(limitedData, 0, 25);

            // Function to handle "Show More" button click
            showMoreBtn.addEventListener('click', () => {
                if (!allRowsVisible) {
                    // Show all rows
                    addRows(fullData, 25, fullData.length);
                    allRowsVisible = true;
                    showMoreBtn.innerText = 'Show Less';
                } else {
                    // Hide additional rows
                    const rowCount = table.rows.length;
                    for (let i = rowCount - 1; i > 25; i--) {
                        table.deleteRow(i);
                    }
                    allRowsVisible = false;
                    showMoreBtn.innerText = 'Show More';
                }
            });

            // Show the button initially if there are more than 15 rows
            if (fullData.length > 25) {
                showMoreBtn.style.display = 'block';
            }

            // Function to handle row expansion and details display
            function handleRowExpansion(event) {
                const row = event.target.closest('.expandable-row');
                if (!row) return;

                // Check if the row is expanded
                const isExpanded = row.classList.contains('expanded');

                // Toggle the row expansion
                if (isExpanded) {
                    row.classList.remove('expanded');
                } else {
                    // Expand the row and display details
                    row.classList.add('expanded');
                    const position = row.cells[0].textContent;
                    // Retrieve details from your JSON data based on the position or other identifier
                    const details = attackData.find((item) => item['Position'] === position);
                    if (details) {
                        // Add the details to a new cell in the row
                        const detailsCell = row.insertCell(-1);
                        detailsCell.colSpan = 7; // Colspan to span the entire row
                        detailsCell.textContent = `Stars: ${details['Stars']}, Percentage: ${details['Percentage']}, Enemy Townhall: ${details['EnemyTownhall']}`;
                    }
                }
            }

            const toggleButtons = document.querySelectorAll('.toggle-button');
            toggleButtons.forEach((button) => {
                button.addEventListener('click', handleRowExpansion);
            });
        </script>
    </body>
</html>
